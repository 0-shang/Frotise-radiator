<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google" content="notranslate">
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#0056b3">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <title>FROTISE SYSTEM</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Zoom Library -->
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

    <style>
        /* --- BRANDING & UI --- */
        :root {
            --brand: #0056b3; 
            --brand-dark: #002855;
            --promo: #dc3545; 
            --bg: #f8fafc;
        }

        body { background-color: var(--bg); font-family: "Inter", sans-serif; padding-bottom: 100px; -webkit-font-smoothing: antialiased; }
        .fw-800 { font-weight: 800; }
        
        /* HEADER */
        .header-bg {
            background: linear-gradient(135deg, var(--brand) 0%, var(--brand-dark) 100%);
            color: white; padding: 0 0 60px 0;
            border-radius: 0 0 30px 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .brand-title { font-weight: 900; font-size: 2.5rem; letter-spacing: 2px; margin: 0; }
        
        /* LOGIN */
        #loginSection { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-logo { max-width: 240px; margin-bottom: 20px; }
        .login-input { border: none; border-bottom: 2px solid #eee; width: 100%; padding: 15px; text-align: center; font-weight: bold; margin-bottom: 15px; outline: none; }
        .login-input:focus { border-color: var(--brand); }
        .btn-main { background: var(--brand); color: white; width: 100%; padding: 15px; border-radius: 50px; border: none; font-weight: 800; letter-spacing: 1px; }

        /* LIST */
        .search-card { margin: -40px 20px 20px; background: white; padding: 10px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); position: relative; z-index: 10; }
        .search-input { border: none; height: 50px; text-align: center; font-weight: 600; width: 100%; outline: none; font-size: 1.1rem; }
        
        .result-item { background: white; border-radius: 15px; margin-bottom: 10px; padding: 15px; border: 1px solid #f0f0f0; box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: transform 0.1s; }
        .result-item:active { transform: scale(0.98); background: #f1f5f9; }
        
        .part-code { color: var(--brand); font-weight: 800; font-size: 1rem; }
        .part-type { font-size: 0.65rem; background: #e2e8f0; color: #475569; padding: 2px 6px; border-radius: 4px; font-weight: bold; text-transform: uppercase; margin-right: 5px; }
        
        /* STOCK BADGES */
        .badge-stock { font-size: 0.65rem; padding: 3px 8px; border-radius: 4px; font-weight: 800; float: right; }
        .st-ok { background: #dcfce7; color: #15803d; }
        .st-low { background: #ffedd5; color: #c2410c; }
        .st-out { background: #fee2e2; color: #b91c1c; }

        /* CART FAB */
        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--brand); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); z-index: 5000; cursor: pointer; }
        .cart-count { position: absolute; top: 0; right: 0; background: var(--promo); color: white; width: 24px; height: 24px; border-radius: 50%; font-size: 0.75rem; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid white; }

        /* MODAL */
        .modal-img-box { background: #f1f5f9; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 15px; }
        .modal-img { max-height: 200px; max-width: 100%; object-fit: contain; }
        #fullImageView { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: none; justify-content: center; align-items: center; }
        #fullImage { max-width: 100%; max-height: 90%; }

        /* DEBUG */
        #debugLog { font-size: 0.7rem; color: #94a3b8; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

    <!-- IMAGE VIEWER -->
    <div id="fullImageView" onclick="this.style.display='none'">
        <img id="fullImage" src="">
        <div style="position:absolute; bottom:50px; color:white; font-size:0.8rem;">TAP TO CLOSE</div>
    </div>

    <!-- LOGIN -->
    <div id="loginSection">
        <img src="logo.png" alt="FROTISE" class="login-logo">
        <div style="width: 80%; max-width: 300px;">
            <input type="text" id="loginId" class="login-input" placeholder="ID CODE">
            <input type="password" id="loginPass" class="login-input" placeholder="PASSWORD">
            <button onclick="app.login()" class="btn-main">ENTER SYSTEM</button>
            <div id="loginMsg" class="text-danger mt-3 small fw-bold text-center"></div>
            <div id="fileStatus" class="text-muted mt-2 small text-center">Checking data...</div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" style="display:none;">
        <div class="header-bg">
            <div class="d-flex justify-content-between px-4 pt-3 align-items-center">
                <small class="opacity-75">Hi, <b id="uName">User</b></small>
                <i class="bi bi-box-arrow-right fs-4 cursor-pointer" onclick="location.reload()"></i>
            </div>
            <div class="text-center mt-2">
                <h1 class="brand-title">FROTISE</h1>
                <small class="opacity-50 letter-spacing-2" style="letter-spacing: 3px;">PARTS SYSTEM</small>
            </div>
        </div>

        <div class="search-card">
            <input type="text" id="searchInput" class="search-input" placeholder="Type Code, Name or Type..." onkeyup="app.search()">
        </div>

        <div class="container">
            <div id="resultsList"></div>
            <div id="debugLog"></div>
        </div>

        <div class="fab" onclick="app.openCart()">
            <i class="bi bi-cart-fill fs-4"></i>
            <div id="cartBadge" class="cart-count" style="display:none;">0</div>
        </div>
    </div>

    <!-- PRODUCT DETAIL MODAL -->
    <div class="modal fade" id="pModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header border-0"><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body pt-0">
                    <div class="modal-img-box" onclick="app.zoomImg(document.getElementById('mImg').src)">
                        <img id="mImg" class="modal-img" src="" onerror="this.style.display='none'">
                    </div>
                    <div class="text-center">
                        <h2 id="mCode" class="fw-800 mb-1"></h2>
                        <span id="mType" class="badge bg-secondary mb-2"></span>
                        <p id="mName" class="text-muted fw-bold small"></p>
                    </div>
                    
                    <div class="bg-light p-3 rounded-4 mb-3 d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted fw-bold" style="font-size:0.65rem">PRICE</small>
                            <div id="mPriceBox" class="fw-800 fs-5"></div>
                        </div>
                        <div class="text-end">
                            <small class="text-muted fw-bold" style="font-size:0.65rem">STOCK</small>
                            <div id="mStockBox"></div>
                        </div>
                    </div>

                    <div id="mPromoAlert" class="alert alert-warning py-1 small fw-bold mb-3 text-center" style="display:none;">
                        Buy 5+ for Promo Price!
                    </div>

                    <div id="mCartActions" class="d-flex gap-2">
                        <div class="bg-light rounded-pill d-flex align-items-center px-2">
                            <button class="btn btn-sm" onclick="app.adjQty(-1)"><b>-</b></button>
                            <input id="mQty" class="form-control border-0 bg-transparent text-center p-0 fw-bold" style="width:40px" value="1" readonly>
                            <button class="btn btn-sm" onclick="app.adjQty(1)"><b>+</b></button>
                        </div>
                        <button onclick="app.addToCart()" class="btn btn-primary flex-grow-1 rounded-pill fw-bold">ADD TO CART</button>
                    </div>
                    <div id="mOutMsg" class="alert alert-danger text-center fw-bold small mb-0" style="display:none;">Currently Unavailable</div>
                </div>
            </div>
        </div>
    </div>

    <!-- CART MODAL -->
    <div class="modal fade" id="cModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header border-0 bg-light">
                    <h5 class="fw-800 m-0 text-primary ps-2">Your Order</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body bg-white" id="cBody"></div>
                <div class="modal-footer d-block border-0 pt-0 pb-4">
                    <div class="d-flex justify-content-between mb-3 align-items-end">
                        <span class="text-muted small fw-bold">TOTAL ESTIMATE</span>
                        <span id="cTotal" class="fs-2 fw-800 text-dark">0</span>
                    </div>
                    <div id="limitMsg" class="text-danger text-center small fw-bold mb-2" style="display:none;">Limit Exceeded (100,000)</div>
                    <button onclick="app.send()" class="btn btn-success w-100 rounded-pill fw-bold py-3">
                        <i class="bi bi-whatsapp me-2"></i> SEND VIA WHATSAPP
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    const app = (function() {
        // --- ÈÖçÁΩÆ ---
        const ORDER_LIMIT = 100000;
        
        // --- Áî®Êà∑ÂàóË°® (ID/ÂØÜÁ†Å) ---
        // ËøôÈáåÂè™ÊòØÁôªÂΩïÈ™åËØÅÔºåÂÖ∑‰ΩìÁöÑ"ËÉΩ‰∏çËÉΩÁúã"ÂèñÂÜ≥‰∫é CSV Ë°®Ê†ºÈáåÁöÑ CLIENT Âàó
        const USERS = [
            { id: "GH98904", p: "0000", n: "Client GH98904" },
            { id: "GH10328", p: "0000", n: "Yebford Radiator" },
            { id: "GH98791", p: "0000", n: "K.auto" },
            { id: "GH10147", p: "0000", n: "Qualiparts Ent" },
            { id: "GH10307", p: "0000", n: "Yeboah Radiator" },
            { id: "GH98873", p: "0000", n: "Pole to Pole" },
            { id: "GH10051", p: "0000", n: "David Gyamfi" },
            { id: "GH10811", p: "0000", n: "Client GH10811" },
            { id: "GH10112", p: "0000", n: "Client GH10112" },
            { id: "ADMIN",   p: "8888", n: "Admin Mode" } // ÁÆ°ÁêÜÂëòÂèØ‰ª•ÁúãÂà∞ÊâÄÊúâ
        ];

        // --- Áä∂ÊÄÅÂèòÈáè ---
        let rawData = [];
        let filteredData = [];
        let cart = [];
        let curItem = null;
        let curUser = null;
        let pModal, cModal;

        // --- ÂàùÂßãÂåñ ---
        function init() {
            try {
                pModal = new bootstrap.Modal(document.getElementById('pModal'));
                cModal = new bootstrap.Modal(document.getElementById('cModal'));
                if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(()=>{});
                
                loadCSV(); // Á´ãÂç≥Âä†ËΩΩ CSV
            } catch(e) { console.error(e); }
        }

        // --- CSV Â§ÑÁêÜÂºïÊìé ---
        function loadCSV() {
            const status = document.getElementById('fileStatus');
            status.innerText = "Downloading CSV...";
            
            // Âä†ËΩΩ products.csv
            fetch('products.csv?v=' + Date.now())
                .then(r => {
                    if (!r.ok) throw new Error("products.csv not found");
                    return r.text();
                })
                .then(text => {
                    rawData = parseCSV(text);
                    status.innerText = `Ready. Loaded ${rawData.length} products.`;
                    status.className = "text-success mt-2 small text-center fw-bold";
                })
                .catch(err => {
                    status.innerText = "Error: " + err.message;
                    status.className = "text-danger mt-2 small text-center fw-bold";
                });
        }

        function parseCSV(text) {
            const lines = text.split(/\r\n|\n|\r/);
            const data = [];
            
            for (let i = 1; i < lines.length; i++) { // Ë∑≥ËøáÁ¨¨‰∏ÄË°åË°®Â§¥
                const line = lines[i].trim();
                if (!line) continue;

                // Ê≠£ÂàôÂ§ÑÁêÜ CSV ÂºïÂè∑
                const matches = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                
                // Á°Æ‰øùËá≥Â∞ëÊúâË∂≥Â§üÁöÑÂàó
                if (!matches || matches.length < 4) continue;

                const clean = (s) => s ? s.replace(/^"|"$/g, '').trim() : "";

                // --- ÂÖ≥ÈîÆ‰øÆÊîπÔºöÂàóÁöÑÂØπÂ∫îÂÖ≥Á≥ª ---
                // 0: CLIENT (ÂèØËßÅÊÄß)
                // 1: TYPE (Á±ªÂûã)
                // 2: Code (ÁºñÁ†Å)
                // 3: Name (ÂêçÁß∞)
                // 4: Stock (Â∫ìÂ≠ò)
                // 5: Price (‰ª∑Ê†º)
                // 6: Promoprice (‰øÉÈîÄ‰ª∑)
                // 7: New (Êñ∞ÂìÅÊ†áËØÜ)
                
                data.push({
                    clientStr: clean(matches[0]).toUpperCase(), // Column 0: CLIENT
                    type:      clean(matches[1]).toUpperCase(), // Column 1: TYPE
                    code:      clean(matches[2]),               // Column 2: Code
                    name:      clean(matches[3]),               // Column 3: Name
                    stock:     parseInt(clean(matches[4])) || 0,// Column 4: Stock
                    price:     parseFloat(clean(matches[5])) || 0,// Column 5: Price
                    promo:     matches[6] ? parseFloat(clean(matches[6])) : 0, // Column 6: Promoprice
                    new:       (matches[7] && clean(matches[7]) === '1') ? 1 : 0 // Column 7: New
                });
            }
            return data;
        }

        // --- ÁôªÂΩï & Ê†∏ÂøÉËøáÊª§ÈÄªËæë ---
        function login() {
            const id = document.getElementById('loginId').value.trim().toUpperCase();
            const pw = document.getElementById('loginPass').value.trim();
            const user = USERS.find(u => u.id === id && u.p === pw);

            if (user) {
                curUser = user;
                
                // --- ËøôÈáåÁöÑÈÄªËæëÂÆûÁé∞‰∫Ü‰Ω†ÁöÑË¶ÅÊ±Ç ---
                if (user.id === 'ADMIN') {
                    // Â¶ÇÊûúÊòØÁÆ°ÁêÜÂëòÔºåÁúãÊâÄÊúâÊï∞ÊçÆÔºàÂåÖÊã¨Á©∫ÁôΩÁöÑÔºâ
                    filteredData = rawData;
                } else {
                    filteredData = rawData.filter(item => {
                        // 1. Ëé∑ÂèñËØ•‰∫ßÂìÅÁöÑ CLIENT ÂàóÂÜÖÂÆπ
                        const allowedClients = item.clientStr;
                        
                        // 2. Â¶ÇÊûú CLIENT ÂàóÊòØÁ©∫ÁöÑÔºåÊâÄÊúâ‰∫∫ÈÉΩ‰∏çÂèØËßÅÔºàËøîÂõû falseÔºâ
                        if (!allowedClients || allowedClients === "") {
                            return false;
                        }

                        // 3. Ê£ÄÊü•ÂΩìÂâçÁî®Êà∑ ID ÊòØÂê¶Âú® CLIENT Â≠óÁ¨¶‰∏≤‰∏≠
                        // ‰ΩøÁî® includes ÊîØÊåÅ‰∏Ä‰∏™ÂçïÂÖÉÊ†ºÈáåÂÜôÂ§ö‰∏™ÂÆ¢Êà∑ ID (‰æãÂ¶Ç: "GH98904,GH10328")
                        return allowedClients.includes(user.id);
                    });
                }

                document.getElementById('uName').innerText = user.n;
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Ë∞ÉËØï‰ø°ÊÅØ
                document.getElementById('debugLog').innerText = `Database: ${rawData.length} | Visible to ${user.id}: ${filteredData.length}`;
                
                search();
            } else {
                document.getElementById('loginMsg').innerText = "Access Denied";
            }
        }

        // --- ÊêúÁ¥¢ÂäüËÉΩ ---
        function search() {
            const term = document.getElementById('searchInput').value.toUpperCase().trim();
            const container = document.getElementById('resultsList');
            let data = filteredData;

            if (data.length === 0) {
                container.innerHTML = `<div class="text-center text-muted mt-5">No products assigned to your account.</div>`;
                return;
            }

            if (term) {
                const terms = term.split(/\s+/);
                data = data.filter(item => {
                    const str = `${item.code} ${item.name} ${item.type}`.toUpperCase();
                    return terms.every(t => str.includes(t));
                });
            }

            if (data.length === 0) {
                container.innerHTML = `<div class="text-center text-muted mt-5">No matches found.</div>`;
                return;
            }

            // ÈôêÂà∂Ê∏≤ÊüìÂâç 50 Êù°‰ª•‰øùÊåÅÊµÅÁïÖ
            let html = "";
            data.slice(0, 50).forEach(item => {
                let badge = "";
                if(item.stock <= 0) badge = `<span class="badge-stock st-out">OUT</span>`;
                else if(item.stock <= 10) badge = `<span class="badge-stock st-low">LOW</span>`;
                else badge = `<span class="badge-stock st-ok">IN STOCK</span>`;

                let priceDisplay = `<span class="fw-bold">${item.price}</span>`;
                if(item.promo > 0 && item.promo < item.price) {
                    priceDisplay = `<span class="p-orig small">${item.price}</span><span class="text-danger fw-bold">${item.promo}</span>`;
                }

                html += `
                <div class="result-item" onclick="app.openDetail('${item.code}')">
                    <div class="d-flex justify-content-between mb-1">
                        <div class="part-code">
                            ${item.code} 
                            ${item.new ? '<span class="badge bg-primary ms-1" style="font-size:0.5rem">NEW</span>' : ''}
                        </div>
                        ${badge}
                    </div>
                    <div class="mb-1"><span class="part-type">${item.type}</span></div>
                    <div class="part-name">${item.name}</div>
                    <div class="text-end mt-2">${priceDisplay}</div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // --- ËØ¶ÊÉÖÈ°µ ---
        function openDetail(code) {
            curItem = filteredData.find(i => i.code === code);
            if (!curItem) return;

            document.getElementById('mCode').innerText = curItem.code;
            document.getElementById('mName').innerText = curItem.name;
            document.getElementById('mType').innerText = curItem.type;
            
            const img = document.getElementById('mImg');
            // ÂõæÁâáË∑ØÂæÑÈÄªËæëÔºöÁ°Æ‰øù‰Ω†ÁöÑÂõæÁâáÊòØ jpg Âπ∂‰∏îÊîæÂú® images Êñá‰ª∂Â§π‰∏ã
            img.src = `images/${curItem.code}.jpg`;
            img.style.display = 'block';

            // ‰ª∑Ê†ºÈÄªËæë
            const pBox = document.getElementById('mPriceBox');
            const hasPromo = curItem.promo > 0 && curItem.promo < curItem.price;
            
            if (hasPromo) {
                pBox.innerHTML = `<span class="p-orig text-muted fs-6">${curItem.price}</span> <span class="text-danger">${curItem.promo}</span>`;
                document.getElementById('mPromoAlert').style.display = 'block';
            } else {
                pBox.innerHTML = curItem.price;
                document.getElementById('mPromoAlert').style.display = 'none';
            }

            // Â∫ìÂ≠òÈÄªËæë
            const sBox = document.getElementById('mStockBox');
            const actions = document.getElementById('mCartActions');
            const outMsg = document.getElementById('mOutMsg');

            if (curItem.stock > 0) {
                sBox.innerHTML = curItem.stock <= 10 ? `<span class="text-warning fw-bold">LOW STOCK</span>` : `<span class="text-success fw-bold">IN STOCK</span>`;
                actions.style.display = 'flex';
                outMsg.style.display = 'none';
            } else {
                sBox.innerHTML = `<span class="text-danger fw-bold">OUT OF STOCK</span>`;
                actions.style.display = 'none';
                outMsg.style.display = 'block';
            }

            document.getElementById('mQty').value = 1;
            pModal.show();
        }

        // --- Ë¥≠Áâ©ËΩ¶ÈÄªËæë ---
        function adjQty(d) {
            let v = parseInt(document.getElementById('mQty').value) + d;
            if (v < 1) v = 1;
            if (curItem && v > curItem.stock) { alert("Max stock reached"); v = curItem.stock; }
            document.getElementById('mQty').value = v;
        }

        function addToCart() {
            if (!curItem) return;
            const qty = parseInt(document.getElementById('mQty').value);
            const exists = cart.find(x => x.code === curItem.code);
            
            if (exists) {
                if (exists.qty + qty > curItem.stock) return alert("Total quantity exceeds stock");
                exists.qty += qty;
            } else {
                cart.push({...curItem, qty: qty});
            }
            pModal.hide();
            updBadge();
        }

        function updBadge() {
            const t = cart.reduce((a, b) => a + b.qty, 0);
            const b = document.getElementById('cartBadge');
            b.innerText = t;
            b.style.display = t > 0 ? 'flex' : 'none';
        }

        function openCart() {
            const body = document.getElementById('cBody');
            let total = 0;
            let html = "";

            if (cart.length === 0) {
                body.innerHTML = `<div class="text-center py-5 text-muted">Cart is empty</div>`;
            } else {
                cart.forEach((item, idx) => {
                    let p = item.price;
                    let isPromoApplied = false;
                    
                    if (item.promo > 0 && item.qty >= 5) {
                        p = item.promo;
                        isPromoApplied = true;
                    }
                    total += p * item.qty;

                    html += `
                    <div class="d-flex justify-content-between align-items-center border-bottom py-3">
                        <div style="width:65%">
                            <div class="fw-bold text-dark small">${item.code}</div>
                            <div class="text-muted small text-truncate">${item.name}</div>
                            <div class="fw-bold mt-1 ${isPromoApplied?'text-danger':''}">${p} x ${item.qty}</div>
                            ${item.promo>0 && !isPromoApplied ? `<small class="text-warning fw-bold" style="font-size:0.6rem">Add ${5-item.qty} more for Promo</small>` : ''}
                        </div>
                        <button onclick="app.delItem(${idx})" class="btn btn-sm btn-outline-danger border-0 fw-bold">REMOVE</button>
                    </div>`;
                });
                body.innerHTML = html;
            }
            document.getElementById('cTotal').innerText = total;
            document.getElementById('limitMsg').style.display = total > ORDER_LIMIT ? 'block' : 'none';
            cModal.show();
        }

        function delItem(i) {
            cart.splice(i, 1);
            updBadge();
            openCart();
        }

        function send() {
            if (cart.length === 0) return;
            let t = 0;
            let items = [];
            cart.forEach(i => {
                let p = (i.promo > 0 && i.qty >= 5) ? i.promo : i.price;
                t += p * i.qty;
                items.push(`‚ñ™ ${i.code} (x${i.qty}) @ ${p}`);
            });

            if(t > ORDER_LIMIT) return alert("Order value exceeds limit!");

            const msg = `üõí *ORDER: ${curUser.n}*\n\n` + items.join('\n') + `\n\n*TOTAL: ${t}*`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
            
            cart = [];
            updBadge();
            cModal.hide();
        }
        
        // ÂõæÁâáÊîæÂ§ß
        function zoomImg(src) {
             // ÁÆÄÂçïÁöÑÂõæÁâáÊü•ÁúãÂô®ÈÄªËæë
             const viewer = document.getElementById('fullImageView');
             const fullImg = document.getElementById('fullImage');
             fullImg.src = src;
             viewer.style.display = 'flex';
        }

        return { init, login, search, openDetail, zoomImg, adjQty, addToCart, openCart, delItem, send };
    })();

    document.addEventListener('DOMContentLoaded', app.init);
    document.getElementById('loginPass').addEventListener('keypress', (e)=>{ if(e.key==='Enter') app.login(); });
    </script>
</body>
</html>